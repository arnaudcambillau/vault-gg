{% extends 'base_app.html.twig' %}

{% block title %}Gestion Utilisateurs - Vault.gg{% endblock %}

{% block content %}

<!-- Messages flash -->
{% for label, messages in app.flashes %}
    {% for message in messages %}
        <div class="p-4 rounded-lg mb-4 
            {% if label == 'success' %}bg-green-500/20 border border-green-500/30 text-green-400{% endif %}
            {% if label == 'error' %}bg-red-500/20 border border-red-500/30 text-red-400{% endif %}">
            {{ message }}
        </div>
    {% endfor %}
{% endfor %}

<!-- En-tÃªte -->
<div class="mb-6">
    <div class="flex items-center justify-between flex-wrap gap-4">
        <div>
            <h1 class="text-3xl font-black mb-2 flex items-center gap-3">
                <i data-lucide="users" class="w-9 h-9 text-indigo-500"></i>
                Gestion des utilisateurs
            </h1>
            <p class="text-slate-400">
                {{ usersStats|length }} utilisateur{% if usersStats|length > 1 %}s{% endif %} enregistrÃ©{% if usersStats|length > 1 %}s{% endif %}
            </p>
        </div>
        <a href="{{ path('app_admin_dashboard') }}" 
            class="bg-indigo-500/20 text-indigo-400 px-5 py-2.5 rounded-lg border border-indigo-500/30 
                no-underline font-semibold flex items-center gap-2 transition-all hover:bg-indigo-500/30">
            <i data-lucide="arrow-left" class="w-[18px] h-[18px]"></i>
            Retour au dashboard
        </a>
    </div>
</div>

<!-- Liste des utilisateurs -->
<div class="glass p-6">
    {% if usersStats|length > 0 %}
        <div class="overflow-x-auto">
            <table class="w-full border-collapse">
                <thead>
                    <tr class="border-b-2 border-indigo-500/20">
                        <th class="p-3 text-left font-bold text-slate-100">Utilisateur</th>
                        <th class="p-3 text-center font-bold text-slate-100">Email</th>
                        <th class="p-3 text-center font-bold text-slate-100">Jeux</th>
                        <th class="p-3 text-center font-bold text-slate-100">TerminÃ©s</th>
                        <th class="p-3 text-center font-bold text-slate-100">Favoris</th>
                        <th class="p-3 text-center font-bold text-slate-100">RÃ´le</th>
                        <th class="p-3 text-center font-bold text-slate-100">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for userStat in usersStats %}
                        {% set user = userStat.user %}
                        <tr class="border-b border-indigo-500/10 hover:bg-slate-800/30 transition-colors">
                            <td class="p-4">
                                <div class="flex items-center gap-3">
                                    {% if user.avatar %}
                                        <img src="{{ asset('uploads/avatars/' ~ user.avatar) }}" 
                                            alt="Avatar" 
                                            class="w-10 h-10 rounded-full object-cover">
                                    {% else %}
                                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-violet-500 
                                                    flex items-center justify-center font-bold text-white">
                                            {{ user.username|first|upper }}
                                        </div>
                                    {% endif %}
                                    <span class="font-semibold text-slate-100">{{ user.username }}</span>
                                </div>
                            </td>
                            <td class="p-4 text-center text-slate-400">{{ user.email }}</td>
                            <td class="p-4 text-center font-bold text-indigo-400">{{ userStat.totalGames }}</td>
                            <td class="p-4 text-center font-bold text-green-400">{{ userStat.completed }}</td>
                            <td class="p-4 text-center font-bold text-red-400">{{ userStat.favorites }}</td>
                            <td class="p-4 text-center">
                                {% if 'ROLE_ADMIN' in user.roles %}
                                    <span class="bg-amber-500/20 text-amber-500 px-3 py-1 rounded-full text-xs font-semibold">
                                        ðŸ‘‘ ADMIN
                                    </span>
                                {% else %}
                                    <span class="bg-indigo-500/20 text-indigo-400 px-3 py-1 rounded-full text-xs font-semibold">
                                        USER
                                    </span>
                                {% endif %}
                            </td>
                            <td class="p-4 text-center">
                                {% if user.id != app.user.id %}
                                    <form method="post" 
                                        action="{{ path('app_admin_user_delete', {id: user.id}) }}" 
                                        onsubmit="return confirm('ÃŠtes-vous sÃ»r de vouloir supprimer {{ user.username }} ?');" 
                                        class="inline">
                                        <button type="submit" 
                                                class="bg-red-500/20 text-red-400 px-3 py-1.5 rounded-md border border-red-500/30 
                                                    cursor-pointer font-semibold inline-flex items-center gap-2 transition-all 
                                                    hover:bg-red-500/30 hover:-translate-y-0.5">
                                            <i data-lucide="trash-2" class="w-3.5 h-3.5"></i>
                                            Supprimer
                                        </button>
                                    </form>
                                {% else %}
                                    <span class="text-slate-400 text-xs">C'est vous !</span>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p class="text-slate-400 text-center py-12">Aucun utilisateur</p>
    {% endif %}
</div>

{% endblock %}