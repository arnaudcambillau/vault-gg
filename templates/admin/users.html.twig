{% extends 'base_app.html.twig' %}

{% block title %}Gestion Utilisateurs - Vault.gg{% endblock %}

{% block content %}

<!-- Messages flash -->
{% for label, messages in app.flashes %}
    {% for message in messages %}
        <div style="padding: 16px; border-radius: 8px; margin-bottom: 16px; 
            {% if label == 'success' %}background: rgba(16, 185, 129, 0.2); border: 1px solid rgba(16, 185, 129, 0.3); color: #10B981;{% endif %}
            {% if label == 'error' %}background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.3); color: #EF4444;{% endif %}">
            {{ message }}
        </div>
    {% endfor %}
{% endfor %}

<div style="margin-bottom: 24px;">
    <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 16px;">
        <div>
            <h1 style="font-size: 32px; font-weight: 900; margin-bottom: 8px; display: flex; align-items: center; gap: 12px;">
                <i data-lucide="users" style="width: 36px; height: 36px; color: #6366F1;"></i>
                Gestion des utilisateurs
            </h1>
            <p style="color: #94A3B8;">{{ usersStats|length }} utilisateur{% if usersStats|length > 1 %}s{% endif %} enregistrÃ©{% if usersStats|length > 1 %}s{% endif %}</p>
        </div>
        <a href="{{ path('app_admin_dashboard') }}" style="background: rgba(99, 102, 241, 0.2); color: #6366F1; padding: 10px 20px; border-radius: 8px; border: 1px solid rgba(99, 102, 241, 0.3); text-decoration: none; font-weight: 600; display: flex; align-items: center; gap: 8px; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(99, 102, 241, 0.3)';" onmouseout="this.style.background='rgba(99, 102, 241, 0.2)';">
            <i data-lucide="arrow-left" style="width: 18px; height: 18px;"></i>
            Retour au dashboard
        </a>
    </div>
</div>

<!-- Liste des utilisateurs -->
<div class="glass" style="padding: 24px;">
    {% if usersStats|length > 0 %}
        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="border-bottom: 2px solid rgba(99, 102, 241, 0.2);">
                        <th style="padding: 12px; text-align: left; font-weight: 700; color: #F1F5F9;">Utilisateur</th>
                        <th style="padding: 12px; text-align: center; font-weight: 700; color: #F1F5F9;">Email</th>
                        <th style="padding: 12px; text-align: center; font-weight: 700; color: #F1F5F9;">Jeux</th>
                        <th style="padding: 12px; text-align: center; font-weight: 700; color: #F1F5F9;">TerminÃ©s</th>
                        <th style="padding: 12px; text-align: center; font-weight: 700; color: #F1F5F9;">Favoris</th>
                        <th style="padding: 12px; text-align: center; font-weight: 700; color: #F1F5F9;">RÃ´le</th>
                        <th style="padding: 12px; text-align: center; font-weight: 700; color: #F1F5F9;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for userStat in usersStats %}
                        {% set user = userStat.user %}
                        <tr style="border-bottom: 1px solid rgba(99, 102, 241, 0.1);">
                            <td style="padding: 16px;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    {% if user.avatar %}
                                        <img src="{{ asset('uploads/avatars/' ~ user.avatar) }}" alt="Avatar" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
                                    {% else %}
                                        <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%); display: flex; align-items: center; justify-content: center; font-weight: 700; color: white;">
                                            {{ user.username|first|upper }}
                                        </div>
                                    {% endif %}
                                    <span style="font-weight: 600; color: #F1F5F9;">{{ user.username }}</span>
                                </div>
                            </td>
                            <td style="padding: 16px; text-align: center; color: #94A3B8;">{{ user.email }}</td>
                            <td style="padding: 16px; text-align: center; font-weight: 700; color: #6366F1;">{{ userStat.totalGames }}</td>
                            <td style="padding: 16px; text-align: center; font-weight: 700; color: #10B981;">{{ userStat.completed }}</td>
                            <td style="padding: 16px; text-align: center; font-weight: 700; color: #EF4444;">{{ userStat.favorites }}</td>
                            <td style="padding: 16px; text-align: center;">
                                {% if 'ROLE_ADMIN' in user.roles %}
                                    <span style="background: rgba(245, 158, 11, 0.2); color: #F59E0B; padding: 4px 12px; border-radius: 12px; font-size: 11px; font-weight: 600;">ðŸ‘‘ ADMIN</span>
                                {% else %}
                                    <span style="background: rgba(99, 102, 241, 0.2); color: #6366F1; padding: 4px 12px; border-radius: 12px; font-size: 11px; font-weight: 600;">USER</span>
                                {% endif %}
                            </td>
                            <td style="padding: 16px; text-align: center;">
                                {% if user.id != app.user.id %}
                                    <form method="post" action="{{ path('app_admin_user_delete', {id: user.id}) }}" onsubmit="return confirm('ÃŠtes-vous sÃ»r de vouloir supprimer {{ user.username }} ?');" style="display: inline;">
                                        <button type="submit" style="background: rgba(239, 68, 68, 0.2); color: #EF4444; padding: 6px 12px; border-radius: 6px; border: 1px solid rgba(239, 68, 68, 0.3); cursor: pointer; font-weight: 600; display: inline-flex; align-items: center; gap: 4px; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(239, 68, 68, 0.3)';" onmouseout="this.style.background='rgba(239, 68, 68, 0.2)';">
                                            <i data-lucide="trash-2" style="width: 14px; height: 14px;"></i>
                                            Supprimer
                                        </button>
                                    </form>
                                {% else %}
                                    <span style="color: #94A3B8; font-size: 12px;">C'est vous !</span>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p style="color: #94A3B8; text-align: center; padding: 48px 0;">Aucun utilisateur</p>
    {% endif %}
</div>

{% endblock %}