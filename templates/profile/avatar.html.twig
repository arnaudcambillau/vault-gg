{% extends 'base_app.html.twig' %}

{% block title %}Changer ma photo de profil - Vault.gg{% endblock %}

{% block content %}

<!-- Messages flash -->
{% for label, messages in app.flashes %}
    {% for message in messages %}
        <div class="p-4 rounded-lg mb-4 
            {% if label == 'success' %}bg-green-500/20 border border-green-500/30 text-green-400{% endif %}
            {% if label == 'error' %}bg-red-500/20 border border-red-500/30 text-red-400{% endif %}">
            {{ message }}
        </div>
    {% endfor %}
{% endfor %}

<!-- En-tête -->
<div class="mb-6">
    <h1 class="text-3xl font-black mb-2 flex items-center gap-3">
        <i data-lucide="image" class="w-9 h-9 text-indigo-500"></i>
        Changer ma photo de profil
    </h1>
    <p class="text-slate-400">Personnalisez votre avatar</p>
</div>

<!-- Grid 2 colonnes -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    
    <!-- Formulaire d'upload -->
    <div class="glass p-8 relative">
        <!-- Bouton Fermer en haut à droite -->
        <a href="{{ path('app_profile') }}" 
            class="absolute top-6 right-6 bg-slate-700/20 text-slate-400 w-10 h-10 rounded-lg 
                border border-slate-700/30 no-underline flex items-center justify-center transition-all hover:bg-slate-700/30">
            <i data-lucide="x" class="w-5 h-5"></i>
        </a>

        <h2 class="text-lg font-bold mb-5 text-slate-100">
            Uploader une nouvelle image
        </h2>

        {{ form_start(form) }}
            
            <div class="mb-5">
                {{ form_label(form.avatar, 'Choisir une image', {
                    'label_attr': {
                        'class': 'block font-semibold mb-2 text-slate-100'
                    }
                }) }}
                
                {{ form_widget(form.avatar, {
                    'attr': {
                        'class': 'w-full p-3 bg-slate-800/80 border border-indigo-500/30 rounded-lg text-slate-100 cursor-pointer mb-3'
                    }
                }) }}
                {{ form_errors(form.avatar) }}
                
                <p class="text-slate-400 text-xs mb-4">
                    Formats acceptés : JPG, PNG, GIF, WEBP<br>
                    Taille maximum : 2 Mo
                </p>

                <button type="submit" 
                        class="bg-gradient-to-br from-indigo-500 to-violet-500 text-white px-6 py-3 rounded-lg 
                            font-semibold border-0 cursor-pointer flex items-center gap-2 transition-all hover:-translate-y-0.5 w-full justify-center">
                    <i data-lucide="upload" class="w-[18px] h-[18px]"></i>
                    Enregistrer
                </button>
            </div>

        {{ form_end(form) }}
    </div>

    <!-- Aperçu actuel -->
    <div class="glass p-8 text-center">
        <h2 class="text-lg font-bold mb-5 text-slate-100">
            Avatar actuel
        </h2>

        {% if app.user.avatar %}
            <img src="{{ asset('uploads/avatars/' ~ app.user.avatar) }}" 
                alt="Avatar" 
                class="w-[200px] h-[200px] rounded-full object-cover mb-4 mx-auto shadow-xl shadow-indigo-500/40">
        {% else %}
            <div class="w-[200px] h-[200px] rounded-full bg-gradient-to-br from-indigo-500 to-violet-500 
                        flex items-center justify-center text-7xl font-black text-white mx-auto mb-4 shadow-xl shadow-indigo-500/40">
                {{ app.user.username|first|upper }}
            </div>
        {% endif %}

        <p class="text-slate-400 text-sm">
            {% if app.user.avatar %}
                Votre photo de profil personnalisée
            {% else %}
                Avatar par défaut (initiales)
            {% endif %}
        </p>
    </div>

</div>

{% endblock %}