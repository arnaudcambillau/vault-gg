{% extends 'base_app.html.twig' %}

{% block title %}Mon Profil - Vault.gg{% endblock %}

{% block content %}

<!-- Messages flash -->
{% for label, messages in app.flashes %}
    {% for message in messages %}
        <div style="padding: 16px; border-radius: 8px; margin-bottom: 16px; 
            {% if label == 'success' %}background: rgba(16, 185, 129, 0.2); border: 1px solid rgba(16, 185, 129, 0.3); color: #10B981;{% endif %}
            {% if label == 'error' %}background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.3); color: #EF4444;{% endif %}">
            {{ message }}
        </div>
    {% endfor %}
{% endfor %}

<div style="margin-bottom: 24px;">
    <h1 style="font-size: 32px; font-weight: 900; margin-bottom: 8px; display: flex; align-items: center; gap: 12px;">
        <i data-lucide="user" style="width: 36px; height: 36px; color: #6366F1;"></i>
        Mon Profil
    </h1>
    <p style="color: #94A3B8;">Informations et statistiques de votre compte</p>
</div>

<!-- Carte principale du profil -->
<div class="glass" style="padding: 32px; margin-bottom: 24px;">
    <div style="display: flex; align-items: center; gap: 24px; flex-wrap: wrap;">
        <!-- Avatar cliquable -->
        <div style="position: relative; cursor: pointer;" onclick="document.getElementById('avatar-form-section').style.display = 'block'; lucide.createIcons();">
            {% if user.avatar %}
                <img src="{{ asset('uploads/avatars/' ~ user.avatar) }}" alt="Avatar" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);">
            {% else %}
                <div style="width: 120px; height: 120px; border-radius: 50%; background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%); display: flex; align-items: center; justify-content: center; font-size: 48px; font-weight: 900; color: white; box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);">
                    {{ user.username|first|upper }}
                </div>
            {% endif %}
            
            <!-- Ic√¥ne overlay pour indiquer qu'on peut cliquer -->
            <div style="position: absolute; bottom: 0; right: 0; width: 36px; height: 36px; background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 3px solid #1E293B; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);">
                <i data-lucide="camera" style="width: 18px; height: 18px; color: white;"></i>
            </div>
        </div>
        
        <!-- Informations -->
        <div style="flex: 1; min-width: 250px;">
            <h2 style="font-size: 28px; font-weight: 900; color: #F1F5F9; margin-bottom: 8px;">
                {{ user.username }}
            </h2>
            <div style="display: flex; flex-direction: column; gap: 8px; color: #94A3B8;">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <i data-lucide="mail" style="width: 16px; height: 16px;"></i>
                    <span>{{ user.email }}</span>
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <i data-lucide="calendar" style="width: 16px; height: 16px;"></i>
                    <span>Membre depuis {{ "now"|date('Y') }}</span>
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <i data-lucide="shield" style="width: 16px; height: 16px;"></i>
                    <span>Compte v√©rifi√©</span>
                </div>
            </div>
        </div>

        <!-- Badge niveau -->
        <div style="text-align: center;">
            <div style="width: 80px; height: 80px; border-radius: 50%; background: rgba(245, 158, 11, 0.2); border: 3px solid #F59E0B; display: flex; flex-direction: column; align-items: center; justify-content: center; margin: 0 auto 8px;">
                <i data-lucide="trophy" style="width: 32px; height: 32px; color: #F59E0B;"></i>
            </div>
            <div style="font-size: 12px; font-weight: 600; color: #94A3B8; text-transform: uppercase;">Collectionneur</div>
        </div>
    </div>
</div>

<!-- Formulaire d'upload d'avatar (cach√© par d√©faut) -->
<div id="avatar-form-section" class="glass" style="padding: 24px; margin-bottom: 24px; display: none;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
        <h2 style="font-size: 18px; font-weight: 700; display: flex; align-items: center; gap: 8px; margin: 0;">
            <i data-lucide="image" style="width: 20px; height: 20px; color: #6366F1;"></i>
            Changer la photo de profil
        </h2>
        <button onclick="document.getElementById('avatar-form-section').style.display = 'none';" style="background: rgba(107, 114, 128, 0.2); color: #9CA3AF; padding: 6px 12px; border-radius: 6px; border: 1px solid rgba(107, 114, 128, 0.3); cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 4px; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(107, 114, 128, 0.3)';" onmouseout="this.style.background='rgba(107, 114, 128, 0.2)';">
            <i data-lucide="x" style="width: 16px; height: 16px;"></i>
            Fermer
        </button>
    </div>
    
    {{ form_start(avatarForm, {'action': path('app_profile_upload_avatar'), 'attr': {'enctype': 'multipart/form-data'}}) }}
        <div style="display: flex; gap: 12px; align-items: flex-end;">
            <div style="flex: 1;">
                {{ form_widget(avatarForm.avatar, {'attr': {'style': 'width: 100%; padding: 10px; background: rgba(30, 41, 59, 0.8); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 8px; color: #F1F5F9; cursor: pointer;'}}) }}
                {{ form_errors(avatarForm.avatar) }}
                <p style="color: #94A3B8; font-size: 12px; margin-top: 6px;">
                    Formats accept√©s : JPG, PNG, GIF, WEBP ‚Ä¢ Taille max : 2MB
                </p>
            </div>
            <button type="submit" style="background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%); color: white; padding: 10px 24px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; white-space: nowrap; display: flex; align-items: center; gap: 6px; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)';" onmouseout="this.style.transform='translateY(0)';">
                <i data-lucide="upload" style="width: 16px; height: 16px;"></i>
                Uploader
            </button>
        </div>
    {{ form_end(avatarForm) }}
</div>

<!-- Statistiques en grille -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;">
    <!-- Total jeux -->
    <div class="glass" style="padding: 20px; text-align: center;">
        <div style="width: 48px; height: 48px; background: rgba(99, 102, 241, 0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px;">
            <i data-lucide="library" style="width: 24px; height: 24px; color: #6366F1;"></i>
        </div>
        <div style="font-size: 32px; font-weight: 900; color: #F1F5F9; margin-bottom: 4px;">{{ stats.total }}</div>
        <div style="font-size: 12px; color: #94A3B8; text-transform: uppercase; font-weight: 600;">Jeux au total</div>
    </div>

    <!-- Favoris -->
    <div class="glass" style="padding: 20px; text-align: center;">
        <div style="width: 48px; height: 48px; background: rgba(239, 68, 68, 0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px;">
            <i data-lucide="heart" style="width: 24px; height: 24px; color: #EF4444;"></i>
        </div>
        <div style="font-size: 32px; font-weight: 900; color: #EF4444; margin-bottom: 4px;">{{ stats.favorites }}</div>
        <div style="font-size: 12px; color: #94A3B8; text-transform: uppercase; font-weight: 600;">Favoris</div>
    </div>

    <!-- Termin√©s -->
    <div class="glass" style="padding: 20px; text-align: center;">
        <div style="width: 48px; height: 48px; background: rgba(16, 185, 129, 0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px;">
            <i data-lucide="check-circle" style="width: 24px; height: 24px; color: #10B981;"></i>
        </div>
        <div style="font-size: 32px; font-weight: 900; color: #10B981; margin-bottom: 4px;">{{ stats.completed }}</div>
        <div style="font-size: 12px; color: #94A3B8; text-transform: uppercase; font-weight: 600;">Termin√©s</div>
    </div>

    <!-- Taux de compl√©tion -->
    <div class="glass" style="padding: 20px; text-align: center;">
        <div style="width: 48px; height: 48px; background: rgba(139, 92, 246, 0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px;">
            <i data-lucide="trending-up" style="width: 24px; height: 24px; color: #8B5CF6;"></i>
        </div>
        <div style="font-size: 32px; font-weight: 900; color: #8B5CF6; margin-bottom: 4px;">{{ completionRate }}%</div>
        <div style="font-size: 12px; color: #94A3B8; text-transform: uppercase; font-weight: 600;">Compl√©tion</div>
    </div>
</div>

<!-- Progression par statut -->
<div class="glass" style="padding: 24px; margin-bottom: 24px;">
    <h2 style="font-size: 18px; font-weight: 700; margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
        <i data-lucide="bar-chart" style="width: 20px; height: 20px; color: #6366F1;"></i>
        Progression par statut
    </h2>
    
    <div style="display: flex; flex-direction: column; gap: 16px;">
        <!-- Backlog -->
        <div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                <span style="font-weight: 600; color: #F1F5F9; display: flex; align-items: center; gap: 6px;">
                    <i data-lucide="clock" style="width: 16px; height: 16px; color: #6B7280;"></i>
                    Backlog
                </span>
                <span style="font-weight: 700; color: #6B7280;">{{ stats.backlog }} jeu{% if stats.backlog > 1 %}x{% endif %}</span>
            </div>
            <div style="background: rgba(30, 41, 59, 0.6); height: 12px; border-radius: 6px; overflow: hidden;">
                <div style="background: linear-gradient(135deg, #6B7280 0%, #4B5563 100%); height: 100%; width: {% if stats.total > 0 %}{{ (stats.backlog / stats.total * 100)|round }}%{% else %}0%{% endif %}; transition: width 0.5s ease;"></div>
            </div>
        </div>

        <!-- En cours -->
        <div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                <span style="font-weight: 600; color: #F1F5F9; display: flex; align-items: center; gap: 6px;">
                    <i data-lucide="play-circle" style="width: 16px; height: 16px; color: #F59E0B;"></i>
                    En cours
                </span>
                <span style="font-weight: 700; color: #F59E0B;">{{ stats.in_progress }} jeu{% if stats.in_progress > 1 %}x{% endif %}</span>
            </div>
            <div style="background: rgba(30, 41, 59, 0.6); height: 12px; border-radius: 6px; overflow: hidden;">
                <div style="background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%); height: 100%; width: {% if stats.total > 0 %}{{ (stats.in_progress / stats.total * 100)|round }}%{% else %}0%{% endif %}; transition: width 0.5s ease;"></div>
            </div>
        </div>

        <!-- Termin√© -->
        <div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                <span style="font-weight: 600; color: #F1F5F9; display: flex; align-items: center; gap: 6px;">
                    <i data-lucide="check-circle" style="width: 16px; height: 16px; color: #10B981;"></i>
                    Termin√©
                </span>
                <span style="font-weight: 700; color: #10B981;">{{ stats.completed }} jeu{% if stats.completed > 1 %}x{% endif %}</span>
            </div>
            <div style="background: rgba(30, 41, 59, 0.6); height: 12px; border-radius: 6px; overflow: hidden;">
                <div style="background: linear-gradient(135deg, #10B981 0%, #059669 100%); height: 100%; width: {% if stats.total > 0 %}{{ (stats.completed / stats.total * 100)|round }}%{% else %}0%{% endif %}; transition: width 0.5s ease;"></div>
            </div>
        </div>
    </div>
</div>

<!-- Activit√© r√©cente -->
<div class="glass" style="padding: 24px;">
    <h2 style="font-size: 18px; font-weight: 700; margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
        <i data-lucide="activity" style="width: 20px; height: 20px; color: #6366F1;"></i>
        Activit√© r√©cente
    </h2>
    
    {% if recentGames|length > 0 %}
        <div style="display: flex; flex-direction: column; gap: 12px;">
            {% for userGame in recentGames %}
                {% set game = userGame.game %}
                <div style="display: flex; align-items: center; gap: 16px; padding: 12px; background: rgba(30, 41, 59, 0.4); border-radius: 8px;">
                    <!-- Image -->
                    {% if game.backgroundImage %}
                        <img src="{{ game.backgroundImage }}" alt="{{ game.name }}" style="width: 80px; height: 60px; object-fit: cover; border-radius: 6px;">
                    {% else %}
                        <div style="width: 80px; height: 60px; background: rgba(99, 102, 241, 0.2); border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                            <i data-lucide="gamepad-2" style="width: 24px; height: 24px; color: #6366F1;"></i>
                        </div>
                    {% endif %}
                    
                    <!-- Info -->
                    <div style="flex: 1;">
                        <div style="font-weight: 700; color: #F1F5F9; margin-bottom: 4px;">{{ game.name }}</div>
                        <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
                            <!-- Statut -->
                            {% if userGame.status == 'backlog' %}
                                <span style="background: rgba(107, 114, 128, 0.2); color: #9CA3AF; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">üìö Backlog</span>
                            {% elseif userGame.status == 'in_progress' %}
                                <span style="background: rgba(245, 158, 11, 0.2); color: #F59E0B; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">üéÆ En cours</span>
                            {% elseif userGame.status == 'completed' %}
                                <span style="background: rgba(16, 185, 129, 0.2); color: #10B981; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">‚úÖ Termin√©</span>
                            {% endif %}
                            
                            <!-- Favori -->
                            {% if userGame.isFavorite %}
                                <span style="background: rgba(239, 68, 68, 0.2); color: #EF4444; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">‚ù§Ô∏è Favori</span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Date -->
                    <div style="text-align: right; color: #94A3B8; font-size: 12px;">
                        <div style="display: flex; align-items: center; gap: 4px;">
                            <i data-lucide="plus-circle" style="width: 12px; height: 12px;"></i>
                            {{ userGame.addedAt|date('d/m/Y') }}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p style="color: #94A3B8; text-align: center; padding: 24px 0;">
            Aucune activit√© r√©cente
        </p>
    {% endif %}
</div>

{% endblock %}