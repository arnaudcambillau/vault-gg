{% extends 'base_app.html.twig' %}

{% block title %}Avis sur {{ game.name }} - Vault.gg{% endblock %}

{% block content %}

<!-- Header -->
<header class="mb-6">
    <a href="{{ path('app_home') }}" class="inline-flex items-center gap-2 text-indigo-400 hover:text-indigo-300 mb-4">
        <i data-lucide="arrow-left" class="w-4 h-4"></i>
        Retour à la bibliothèque
    </a>
    <h1 class="text-3xl font-black mb-2 flex items-center gap-3">
        <i data-lucide="message-square" class="w-9 h-9 text-indigo-500"></i>
        Avis sur {{ game.name }}
    </h1>
    <p class="text-slate-400">{{ totalReviews }} avis • Note moyenne : {{ averageRating }}/5</p>
</header>

<!-- Bouton Ajouter un avis -->
<div class="mb-6">
    <a href="{{ path('app_review_add', {'id': game.id}) }}" 
       class="inline-flex items-center gap-2 bg-gradient-to-br from-indigo-500 to-violet-500 text-white px-6 py-3 rounded-lg font-semibold hover:-translate-y-0.5 transition-all">
        <i data-lucide="plus-circle" class="w-5 h-5"></i>
        Écrire un avis
    </a>
</div>

<!-- Liste des avis -->
{% if reviews|length > 0 %}
    <div class="space-y-4">
        {% for review in reviews %}
            <article class="glass rounded-2xl p-6">
                
                <!-- En-tête avis -->
                <div class="flex items-start justify-between mb-4">
                    <div class="flex items-center gap-3">
                        {% if review.userAvatar %}
                            <img src="{{ asset('uploads/avatars/' ~ review.userAvatar) }}" 
                                 alt="{{ review.username }}" 
                                 class="w-12 h-12 rounded-full object-cover">
                        {% else %}
                            <div class="w-12 h-12 rounded-full bg-gradient-to-br from-indigo-500 to-violet-500 flex items-center justify-center text-white font-bold">
                                {{ review.username|first|upper }}
                            </div>
                        {% endif %}
                        <div>
                            <div class="font-bold text-slate-100">{{ review.username }}</div>
                            <div class="text-slate-400 text-sm">{{ review.createdAt|date('d/m/Y') }}</div>
                        </div>
                    </div>
                    
                    <!-- Note -->
                    <div class="flex items-center gap-1">
                        {% for i in 1..5 %}
                            <i data-lucide="star" class="w-4 h-4 {{ i <= review.rating ? 'text-amber-500 fill-amber-500' : 'text-slate-600' }}"></i>
                        {% endfor %}
                    </div>
                </div>

                <!-- Titre -->
                <h3 class="text-lg font-bold text-slate-100 mb-2">{{ review.title }}</h3>

                <!-- Contenu -->
                <p class="text-slate-300 mb-4">{{ review.content }}</p>

                <!-- Footer -->
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        {% if review.isRecommended %}
                            <span class="bg-emerald-500/20 text-emerald-400 px-3 py-1 rounded-full text-sm font-semibold">
                                ✅ Recommandé
                            </span>
                        {% endif %}
                        <span class="text-slate-400 text-sm">{{ review.helpfulCount }} personne(s) ont trouvé cet avis utile</span>
                    </div>
                    
                    <form method="post" action="{{ path('app_review_helpful', {'id': review.id}) }}">
                        <button type="submit" 
                                class="bg-indigo-500/20 text-indigo-400 px-4 py-2 rounded-lg border border-indigo-500/30 font-semibold hover:bg-indigo-500/30 transition-all flex items-center gap-2">
                            <i data-lucide="thumbs-up" class="w-4 h-4"></i>
                            Utile
                        </button>
                    </form>
                </div>
            </article>
        {% endfor %}
    </div>
{% else %}
    <div class="glass rounded-2xl p-12 text-center">
        <i data-lucide="message-square" class="w-16 h-16 text-slate-500 mx-auto mb-4"></i>
        <p class="text-slate-400 text-lg mb-4">Aucun avis pour le moment</p>
        <a href="{{ path('app_review_add', {'id': game.id}) }}" 
           class="inline-flex items-center gap-2 bg-gradient-to-br from-indigo-500 to-violet-500 text-white px-6 py-3 rounded-lg font-semibold hover:-translate-y-0.5 transition-all">
            <i data-lucide="plus-circle" class="w-5 h-5"></i>
            Soyez le premier à donner votre avis !
        </a>
    </div>
{% endif %}

{% endblock %}